<!DOCTYPE html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Radiok : le contrôle vocal</title>
  
  <link rel="stylesheet"
        href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="css/radiok.css">
</head>
<body>
  <div class="container-fluid main">

    <div class="container">
      <div class="row">
        <div class="col-md-12">

          <h2>La configuration audio</h2>
          <p>
            Malheureusement la gestion du son sous linux est
            particulièrement pénible et surtout
            <a href=
               "http://tuxradar.com/content/how-it-works-linux-audio-explained">
              très compliquée</a>. Cet aspect de
              l'application <em class="rk">RadioK</em> est celui qui
              demande le plus d'effort pour obtenir un résultat
              satisfaisant. La contrainte à respecter pour établir la
              configuration audio était de rester le plus simple
              possible tout en permettant de gérer des haut-parleurs
              ou des casques, différents types de micro, branchés en
              usb ou non et de rester homogène sur la raspberry et sur
              des desktops. Pour tenir cette contrainte, sans
              s'arracher les cheveux, on ne peut guère faire
              l'économie de la lecture et de la compréhension de la
              documentation de base sur le sujet.
          </p>
          <p>
            La première chose à faire consiste à vérifier que la
            sortie audio fonctionne correctement sur la rpi. On peut
            tester par exemple dans l'ordre :
            <div class="code">
              <br>aplay /usr/share/sounds/purple/login.wav
              <br>speaker-test -c2 -twav
              <br>mplayer un_fichier.mp3
            </div>
            Si tout va bien on devrait entendre quelquechose. On peut
            (on doit ?) googler quelquechose comme <i>raspberry
            audio</i> pour trouver de la doc. Une des pages la moins inutile est
            <a href=
               "http://jeffskinnerbox.wordpress.com/2012/11/15/getting-audio-out-working-on-the-raspberry-pi/">celle-ci</a>.
         </p>
          <p>
            La solution pour avoir du son sur les haut-parleurs sans
            utiliser la sortie hdmi et pour pouvoir brancher un micro 
            sur la rpi il est bon d'avoir une carte son comme la 
            <a href="http://www.amazon.fr/gp/product/B0037AOUUQ">
              Logilink 250743</a>. L'installation ne pose
            guère de problème car le module driver est disponible dans
            les distributions linux.
          </p>

          <p>
            La difficulté consiste à bien identifier le nom
            du <i>control</i> pour modifier le volume de sortie et
            utiliser le même nom - <code>PCM</code> - sur différents
            matériels de manière à avoir les scripts pour trouver la
            valeur du volume ou pour la changer identiques sur
            différentes machines.<br>
            Ces scripts qui encapsulent <code>amixer get PCM</code> et
            <code>amixer set PCM</code> sont ainsi portables sans
            modification. Mais sur la rpi avec certaines cartes son il
            arrive que <code>PCM</code> n'existe pas. Il faut alors
            créer un fichier <code>~/.asoundrc</code> pour configurer
            la bibliothèque
            <a href="http://www.alsa-project.org/"><code>alsa</code></a>.
            La syntaxe des fichiers de configuration est
            particulièrement imbittable. Ce fichier produit l'effet
            escompté :
            <pre style="width: 25%; margin-left: 3em; margin-bottom:  1em;">
pcm.softvol {
  type softvol
  slave {
     pcm "cards.pcm.default"
  }
  control {
     name  "PCM"
     card  0
  }
}
pcm.!default {
  type  plug
  slave.pcm "softvol"
}
            </pre>


         </p>

          <p>
            la suite va venir !
         </p>

        <div class="center" style="margin-top: 2em;">
          <a class="btn btn-primary" href="index.html">Home</a>
        </div>

        </div>
      </div>

    </div>
  </div>

  <script
     src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js">
  </script>
  <script
     src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js">
  </script>
</body>
</html>
